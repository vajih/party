<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ MISSION CONTROL // CLASSIFIED ACCESS</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin="" />
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <style>
        /* === CRT MONITOR AESTHETIC === */
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --terminal-green: #00ff41;
            --terminal-dark: #0a0e0a;
            --terminal-glow: #00ff4180;
            --amber: #ffb000;
            --red: #ff3860;
        }

        body {
            font-family: 'VT323', monospace;
            background: var(--terminal-dark);
            color: var(--terminal-green);
            overflow: hidden;
            position: relative;
            font-size: 20px;
            line-height: 1.4;
            -webkit-text-size-adjust: 100%; /* Prevent font scaling on mobile */
        }

        /* === MOBILE OPTIMIZATIONS === */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .ascii-art {
                font-size: 10px !important;
                line-height: 1.1;
            }
            
            .terminal-box {
                padding: 20px !important;
                max-width: 90% !important;
            }
            
            .terminal-input {
                width: 100% !important;
                font-size: 20px !important;
            }
            
            .stat-box {
                padding: 15px !important;
            }
            
            .stat-value {
                font-size: 36px !important;
            }
            
            .header h1 {
                font-size: 24px !important;
            }
            
            .section-title {
                font-size: 22px !important;
            }
            
            .profile-name {
                font-size: 20px !important;
            }
            
            .bar-label {
                font-size: 14px !important;
            }
        }

        /* === SCANLINES EFFECT === */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
            animation: flicker 0.15s infinite;
        }

        /* === SCREEN FLICKER === */
        @keyframes flicker {
            0% { opacity: 0.98; }
            50% { opacity: 1; }
            100% { opacity: 0.97; }
        }

        /* === CRT GLOW === */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse at center,
                transparent 0%,
                rgba(0, 255, 65, 0.05) 50%,
                rgba(0, 255, 65, 0.1) 100%
            );
            pointer-events: none;
            z-index: 999;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
        }

        /* === CUSTOM SCROLLBAR === */
        .container::-webkit-scrollbar {
            width: 12px;
        }

        .container::-webkit-scrollbar-track {
            background: var(--terminal-dark);
            border-left: 2px solid var(--terminal-green);
        }

        .container::-webkit-scrollbar-thumb {
            background: var(--terminal-green);
            box-shadow: inset 0 0 6px rgba(0, 255, 65, 0.5);
        }

        /* === BLINKING CURSOR === */
        .cursor {
            animation: blink 1s infinite;
            font-weight: bold;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        /* === TEXT GLOW === */
        .glow {
            text-shadow: 
                0 0 10px var(--terminal-glow),
                0 0 20px var(--terminal-glow);
        }

        .glow-amber {
            color: var(--amber);
            text-shadow: 
                0 0 10px rgba(255, 176, 0, 0.5),
                0 0 20px rgba(255, 176, 0, 0.5);
        }

        .glow-red {
            color: var(--red);
            text-shadow: 
                0 0 10px rgba(255, 56, 96, 0.5),
                0 0 20px rgba(255, 56, 96, 0.5);
        }

        /* === LOGIN SCREEN === */
        #login-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }

        .ascii-art {
            font-size: 16px;
            line-height: 1.2;
            white-space: pre;
            margin-bottom: 30px;
        }

        .terminal-box {
            border: 2px solid var(--terminal-green);
            padding: 30px;
            max-width: 600px;
            box-shadow: 
                0 0 20px var(--terminal-glow),
                inset 0 0 20px rgba(0, 255, 65, 0.1);
            background: rgba(0, 255, 65, 0.02);
        }

        .terminal-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--terminal-green);
            color: var(--terminal-green);
            font-family: 'VT323', monospace;
            font-size: 24px;
            padding: 10px;
            width: 300px;
            text-align: center;
            outline: none;
            letter-spacing: 2px;
        }

        .terminal-input::placeholder {
            color: rgba(0, 255, 65, 0.5);
        }

        .terminal-btn {
            background: transparent;
            border: 2px solid var(--terminal-green);
            color: var(--terminal-green);
            font-family: 'VT323', monospace;
            font-size: 20px;
            padding: 12px 30px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .terminal-btn:hover {
            background: var(--terminal-green);
            color: var(--terminal-dark);
            box-shadow: 0 0 20px var(--terminal-glow);
        }

        .error-msg {
            color: var(--red);
            margin-top: 15px;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* === DASHBOARD === */
        #dashboard {
            display: none;
            background: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            overflow-y: auto;
            height: 100vh;
            color: #2c3e50;
        }

        #dashboard * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif !important;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 300;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .stat-box {
            background: white;
            border-radius: 16px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .stat-box:hover::before {
            width: 100%;
            opacity: 0.05;
        }

        .stat-box h3 {
            color: #718096;
            font-size: 13px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 12px;
            color: #a0aec0;
            font-weight: 400;
        }

        .click-hint {
            position: absolute;
            bottom: 15px;
            right: 20px;
            font-size: 20px;
            color: #cbd5e0;
            transition: all 0.3s ease;
        }

        .stat-box:hover .click-hint {
            color: #667eea;
            transform: translateX(5px);
        }

        .section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin: 0 20px 30px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            color: #2d3748;
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: 0.5px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        /* === DETAIL VIEW MODAL === */
        .detail-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #f5f7fa;
            z-index: 2000;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .detail-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .detail-title {
            font-size: 28px;
            color: #2d3748;
            font-weight: 700;
        }

        .back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-family: inherit;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        .guest-card, .city-card, .photo-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
            border-left: 4px solid transparent;
        }

        .guest-card:hover, .city-card:hover, .photo-card:hover {
            border-left-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .guest-name, .city-name {
            font-size: 20px;
            color: #2d3748;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .guest-email {
            font-size: 14px;
            color: #718096;
            font-family: 'Courier New', monospace;
        }

        .guest-meta {
            display: flex;
            gap: 15px;
            margin-top: 12px;
            font-size: 13px;
            color: #4a5568;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border: 1px solid #667eea30;
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 11px;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .city-count {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .photo-img {
            width: 100%;
            max-width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            font-size: 24px;
            padding: 50px;
        }

        .loading::after {
            content: '‚ñà';
            animation: blink 1s infinite;
        }

        .profile-card {
            border: 1px solid var(--terminal-green);
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(0, 255, 65, 0.01);
        }

        .profile-name {
            color: var(--amber);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .answer-row {
            margin: 8px 0;
            padding-left: 20px;
        }

        .question-label {
            color: rgba(0, 255, 65, 0.7);
        }

        .bar-chart {
            margin: 20px 0;
        }

        .bar {
            background: var(--terminal-green);
            height: 25px;
            margin: 10px 0;
            position: relative;
            box-shadow: 0 0 10px var(--terminal-glow);
            transition: width 1s ease-out;
        }

        .bar-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--terminal-dark);
            font-weight: bold;
            font-size: 18px;
            mix-blend-mode: difference;
        }

        .bar-count {
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--terminal-green);
            font-weight: bold;
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2001;
            background: white;
            border: 2px solid #fc8181;
            color: #fc8181;
            font-family: inherit;
            font-size: 13px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(252, 129, 129, 0.2);
        }

        .logout-btn:hover {
            background: #fc8181;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(252, 129, 129, 0.4);
        }

        .loading {
            text-align: center;
            font-size: 20px;
            padding: 100px 50px;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- === LOGIN SCREEN === -->
        <div id="login-screen">
            <div class="ascii-art glow">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó    ‚ïë
‚ïë  ‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë    ‚ïë
‚ïë  ‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë    ‚ïë
‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë    ‚ïë
‚ïë  ‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë    ‚ïë
‚ïë  ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù    ‚ïë
‚ïë                                                             ‚ïë
‚ïë      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ïë
‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ïë
‚ïë     ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ïë
‚ïë     ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ïë
‚ïë     ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïë
‚ïë      ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            </div>

            <div class="terminal-box">
                <p class="classified-stamp glow-red">‚ö† CLASSIFIED ‚ö†</p>
                <p style="margin: 20px 0;">AUTHORIZED PERSONNEL ONLY</p>
                <p style="margin-bottom: 30px; color: rgba(0, 255, 65, 0.7);">
                    FRIENDSGIVING2025 DATA RETRIEVAL SYSTEM
                </p>
                
                <!-- COUNTDOWN TIMER -->
                <div style="margin: 30px 0; padding: 25px; background: rgba(255, 176, 0, 0.1); border: 2px solid var(--amber); border-radius: 8px; box-shadow: 0 0 20px rgba(255, 176, 0, 0.3);">
                    <div style="font-size: 14px; color: var(--amber); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px;">
                        üöÄ COUNTDOWN TO LAUNCH
                    </div>
                    <div id="countdown-display" style="font-size: 36px; color: var(--terminal-green); font-weight: bold; text-shadow: 0 0 10px var(--terminal-glow); font-family: 'VT323', monospace; letter-spacing: 3px;">
                        --:--:--:--
                    </div>
                    <div id="countdown-label" style="font-size: 12px; color: rgba(0, 255, 65, 0.6); margin-top: 8px; text-transform: uppercase; letter-spacing: 1px;">
                        DAYS : HOURS : MINUTES : SECONDS
                    </div>
                </div>
                
                <div id="typing-text" style="margin-bottom: 20px; min-height: 60px;">
                    <span class="glow-amber">SYSTEM:</span> <span id="typed-content"></span><span class="cursor">‚ñà</span>
                </div>

                <input 
                    type="password" 
                    id="passcode-input" 
                    class="terminal-input" 
                    placeholder="ENTER ACCESS CODE"
                />
                <br>
                <button id="access-btn" class="terminal-btn">ACCESS DATABASE</button>
                <div id="error-message" class="error-msg"></div>
            </div>
        </div>

        <!-- === DASHBOARD === -->
        <div id="dashboard">
            <button class="logout-btn" onclick="logout()">[ LOGOUT ]</button>
            
            <div class="header">
                <h1 class="glow">Mission Control Dashboard</h1>
                <p>FRIENDSGIVING2025 // Real-time Analytics</p>
            </div>

            <div id="loading" class="loading">
                ACCESSING DATABASE<span class="cursor">‚ñà</span>
            </div>

            <div id="dashboard-content" style="display: none;">
                <!-- Stats Overview -->
                <div class="stats-grid">
                    <div class="stat-box" onclick="showGuestList()">
                        <h3>Total Guests</h3>
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Click to view all guests</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box" onclick="showCompletedProfiles()">
                        <h3>Completed Profiles</h3>
                        <div class="stat-value" id="stat-complete">0</div>
                        <div class="stat-label">Full About You responses</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box" onclick="showPhotos()">
                        <h3>Baby Photos</h3>
                        <div class="stat-value" id="stat-photos">0</div>
                        <div class="stat-label">Photos submitted</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box" onclick="showBirthCities()">
                        <h3>Birth Cities</h3>
                        <div class="stat-value" id="stat-cities">0</div>
                        <div class="stat-label">Unique cities</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box" onclick="showZodiacSigns()">
                        <h3>Zodiac Signs</h3>
                        <div class="stat-value" id="stat-zodiacs">0</div>
                        <div class="stat-label">Astrological distribution</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box" onclick="showIncompleteProfiles()">
                        <h3>Waiting to Complete</h3>
                        <div class="stat-value" id="stat-incomplete">0</div>
                        <div class="stat-label">Missing About You or Baby Photo</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box" onclick="showAnswerInsights()">
                        <h3>Total Responses</h3>
                        <div class="stat-value" id="stat-answers">0</div>
                        <div class="stat-label">Data points collected</div>
                        <span class="click-hint">‚Üí</span>
                    </div>
                    <div class="stat-box">
                        <h3>System Status</h3>
                        <div class="stat-value" style="font-size: 28px;">LIVE</div>
                        <div class="stat-label">All systems operational</div>
                    </div>
                </div>

                <!-- Quick Overview Section -->
                <div class="section">
                    <h2 class="section-title">Quick Overview</h2>
                    <div id="quick-overview"></div>
                </div>
            </div>

            <!-- Detail Views -->
            <div id="guest-list-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">All Guests</div>
                        <button class="back-btn" onclick="closeDetailView('guest-list-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="guest-list-content"></div>
                </div>
            </div>

            <div id="completed-profiles-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">Completed Profiles</div>
                        <button class="back-btn" onclick="closeDetailView('completed-profiles-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="completed-profiles-content"></div>
                </div>
            </div>

            <div id="photos-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">Baby Photos</div>
                        <button class="back-btn" onclick="closeDetailView('photos-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="photos-content"></div>
                </div>
            </div>

            <div id="birth-cities-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">Birth Cities</div>
                        <button class="back-btn" onclick="closeDetailView('birth-cities-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="birth-cities-content"></div>
                </div>
            </div>

            <div id="zodiac-signs-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">Zodiac Signs</div>
                        <button class="back-btn" onclick="closeDetailView('zodiac-signs-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="zodiac-signs-content"></div>
                </div>
            </div>

            <div id="answer-insights-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">Answer Insights</div>
                        <button class="back-btn" onclick="closeDetailView('answer-insights-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="answer-insights-content"></div>
                </div>
            </div>

            <div id="incomplete-profiles-view" class="detail-view">
                <div class="detail-container">
                    <div class="detail-header">
                        <div class="detail-title">Waiting to Complete</div>
                        <button class="back-btn" onclick="closeDetailView('incomplete-profiles-view')">‚Üê Back to Dashboard</button>
                    </div>
                    <div id="incomplete-profiles-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="config/env.local.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // === CONFIG ===
        const PASSCODE = 'DOSTI'; // Change this to your secret code!
        const PARTY_SLUG = 'friendsgiving2025-1ty7';
        let PARTY_DATE = null; // Will be loaded from database
        let countdownInterval = null;
        
        // === SUPABASE CLIENT ===
        const { createClient } = supabase;
        const supabaseClient = createClient(
            window.CONFIG.SUPABASE_URL,
            window.CONFIG.SUPABASE_ANON_KEY
        );

        // === COUNTDOWN TIMER ===
        async function initCountdown() {
            try {
                // Fetch party date from database
                const { data: party, error } = await supabaseClient
                    .from('parties')
                    .select('date')
                    .eq('slug', PARTY_SLUG)
                    .single();

                if (error || !party || !party.date) {
                    console.error('Error fetching party date:', error);
                    document.getElementById('countdown-display').innerHTML = 'DATE TBA';
                    document.getElementById('countdown-label').innerHTML = 'PARTY DATE TO BE ANNOUNCED';
                    return;
                }

                PARTY_DATE = new Date(party.date);
                updateCountdown();
                
                // Update countdown every second
                countdownInterval = setInterval(updateCountdown, 1000);
            } catch (err) {
                console.error('Error initializing countdown:', err);
                document.getElementById('countdown-display').innerHTML = 'ERROR';
                document.getElementById('countdown-label').innerHTML = 'UNABLE TO LOAD DATE';
            }
        }

        function updateCountdown() {
            if (!PARTY_DATE) return;
            const now = new Date().getTime();
            const distance = PARTY_DATE.getTime() - now;
            
            if (distance < 0) {
                document.getElementById('countdown-display').innerHTML = 'üéâ PARTY TIME! üéâ';
                document.getElementById('countdown-label').innerHTML = 'THE PARTY HAS BEGUN!';
                return;
            }
            
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            const displayDays = String(days).padStart(2, '0');
            const displayHours = String(hours).padStart(2, '0');
            const displayMinutes = String(minutes).padStart(2, '0');
            const displaySeconds = String(seconds).padStart(2, '0');
            
            document.getElementById('countdown-display').innerHTML = 
                `${displayDays}:${displayHours}:${displayMinutes}:${displaySeconds}`;
        }

        // Initialize countdown on page load
        initCountdown();

        // === TYPING ANIMATION ===
        const messages = [
            "INITIALIZING SECURE CONNECTION...",
            "ESTABLISHING ENCRYPTED CHANNEL...",
            "READY FOR AUTHENTICATION..."
        ];
        let messageIndex = 0;
        let charIndex = 0;
        let typingSpeed = 50;

        function typeMessage() {
            if (messageIndex < messages.length) {
                if (charIndex < messages[messageIndex].length) {
                    document.getElementById('typed-content').textContent += messages[messageIndex].charAt(charIndex);
                    charIndex++;
                    setTimeout(typeMessage, typingSpeed);
                } else {
                    messageIndex++;
                    charIndex = 0;
                    document.getElementById('typed-content').textContent += '\n';
                    
                    if (messageIndex < messages.length) {
                        setTimeout(typeMessage, 500);
                    } else {
                        // Typing complete - input is already visible
                        document.getElementById('passcode-input').focus();
                    }
                }
            }
        }

        // Start typing on load
        window.addEventListener('load', () => {
            setTimeout(typeMessage, 1000);
        });

        // === LOGIN HANDLER ===
        document.getElementById('access-btn')?.addEventListener('click', checkPasscode);
        document.getElementById('passcode-input')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkPasscode();
        });

        function checkPasscode() {
            const input = document.getElementById('passcode-input').value;
            const errorMsg = document.getElementById('error-message');
            
            if (input === PASSCODE) {
                errorMsg.textContent = '';
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadDashboardData();
            } else {
                errorMsg.textContent = '‚ö† ACCESS DENIED // INVALID CREDENTIALS ‚ö†';
                document.getElementById('passcode-input').value = '';
                
                // Shake effect
                setTimeout(() => {
                    errorMsg.textContent = '';
                }, 3000);
            }
        }

        function logout() {
            if (confirm('TERMINATE SECURE SESSION?')) {
                location.reload();
            }
        }

        // === QUESTION LABELS ===
        const questionLabels = {
            birth_city: "City of Birth",
            food_pulao_biryani: "Pulao vs Biryani",
            food_comfort: "Comfort Food",
            food_desi_restaurant: "Desi Restaurant",
            breakfast_nashta: "Breakfast Choice",
            zodiac_sign: "Zodiac Sign",
            araam_mode: "Araam Mode",
            free_saturday: "Free Saturday",
            decision_style: "Decision Style",
            communication_style: "Communication Style",
            left_on_read: "Left on Read",
            fav_city_travel: "Favorite Travel City",
            travel_vibe: "Travel Vibe",
            tsa_luggage: "TSA Luggage",
            smuggled_pakistan: "Smuggled from Pakistan",
            desi_party_personality: "Party Personality",
            celebrity_crush_teen: "Teen Celebrity Crush",
            tv_obsession: "TV Obsession",
            reading_vibe: "Reading Vibe",
            music_vibe: "Music Vibe",
            culture_marriage_love_arranged: "Marriage Preference"
        };

        // === GLOBAL DATA STORAGE ===
        let globalProfiles = [];
        let globalPhotos = [];
        let globalPartyId = null;
        let globalAllAuthUsers = [];

        // === LOAD DASHBOARD DATA ===
        async function loadDashboardData() {
            try {
                // Get party ID from slug
                const { data: party, error: partyError } = await supabaseClient
                    .from('parties')
                    .select('id')
                    .eq('slug', PARTY_SLUG)
                    .single();

                if (partyError) throw partyError;
                globalPartyId = party.id;

                // Get all profiles with About You data
                const { data: profiles, error: profilesError } = await supabaseClient
                    .from('party_profiles')
                    .select('*, birth_lat, birth_lng')
                    .eq('party_id', party.id);

                if (profilesError) throw profilesError;

                // Store profiles globally
                globalProfiles = profiles || [];
                
                // For incomplete tracking, we'll use profiles as the source
                // Users are tracked when they create a profile (even if incomplete)
                globalAllAuthUsers = profiles.map(p => ({
                    id: p.user_id,
                    email: p.email || 'Email not available',
                    created_at: p.created_at,
                    display_name: p.display_name
                }));

                // Get baby photos
                const { data: photos, error: photosError } = await supabaseClient
                    .from('submissions')
                    .select(`
                        *,
                        games!inner(type)
                    `)
                    .eq('party_id', party.id)
                    .eq('games.type', 'baby_photo');

                // Store globally
                globalPhotos = photos || [];

                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';

                // Render data
                renderStats(profiles);
                renderQuickOverview(profiles);

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = 
                    '<span style="color: #fc8181;">‚ö† DATABASE CONNECTION FAILED ‚ö†</span>';
            }
        }

        // === RENDER STATS ===
        function renderStats(profiles) {
            const total = profiles.length;
            const complete = profiles.filter(p => p.extended_answers && Object.keys(p.extended_answers).length > 15).length;
            const totalAnswers = profiles.reduce((sum, p) => 
                sum + (p.extended_answers ? Object.keys(p.extended_answers).length : 0), 0
            );
            const uniqueCities = new Set(profiles.filter(p => p.birth_city).map(p => p.birth_city)).size;
            
            // Calculate incomplete: users who haven't completed BOTH About You AND uploaded baby photo
            // A user is considered "complete" if they have:
            // 1. Profile with 16+ extended_answers (completed About You)
            // 2. Uploaded a baby photo
            const usersWithPhotos = new Set(globalPhotos.map(p => p.user_id));
            const fullyCompleteUserIds = new Set(
                profiles
                    .filter(p => p.extended_answers && Object.keys(p.extended_answers).length > 15)
                    .filter(p => usersWithPhotos.has(p.user_id))
                    .map(p => p.user_id)
            );
            
            // Incomplete = all auth users minus fully complete users
            const incompleteCount = globalAllAuthUsers.filter(u => !fullyCompleteUserIds.has(u.id)).length;

            // Count unique zodiac signs
            const uniqueZodiacs = new Set(
                profiles
                    .map(p => (p.extended_answers && p.extended_answers.zodiac_sign) || p.zodiac_sign)
                    .filter(z => z && z !== 'Not shared')
            ).size;

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-complete').textContent = complete;
            document.getElementById('stat-answers').textContent = totalAnswers;
            document.getElementById('stat-photos').textContent = globalPhotos.length;
            document.getElementById('stat-cities').textContent = uniqueCities;
            document.getElementById('stat-zodiacs').textContent = uniqueZodiacs;
            document.getElementById('stat-incomplete').textContent = incompleteCount;
        }

        // === RENDER QUICK OVERVIEW ===
        function renderQuickOverview(profiles) {
            const container = document.getElementById('quick-overview');
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px;">${profiles.length}</div>
                        <div style="font-size: 14px; color: #718096;">Total Guests</div>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px;">${profiles.filter(p => p.birth_city).length}</div>
                        <div style="font-size: 14px; color: #718096;">Birth Cities Shared</div>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px;">${profiles.filter(p => p.zodiac_sign || (p.extended_answers && p.extended_answers.zodiac_sign)).length}</div>
                        <div style="font-size: 14px; color: #718096;">Zodiac Signs</div>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px;">${globalPhotos.length}</div>
                        <div style="font-size: 14px; color: #718096;">Baby Photos</div>
                    </div>
                </div>
            `;
        }

        // === VIEW FUNCTIONS ===
        function showGuestList() {
            const container = document.getElementById('guest-list-content');
            
            // Sort alphabetically by display_name
            const sortedProfiles = [...globalProfiles].sort((a, b) => 
                a.display_name.localeCompare(b.display_name)
            );
            
            // Update the title with count
            document.querySelector('#guest-list-view .detail-title').textContent = `All Guests (${sortedProfiles.length})`;
            
            container.innerHTML = sortedProfiles.map((profile, index) => {
                const answerCount = profile.extended_answers ? Object.keys(profile.extended_answers).length : 0;
                const isComplete = answerCount > 15;
                
                // Get zodiac from extended_answers first, then fall back to zodiac_sign column
                const zodiac = (profile.extended_answers && profile.extended_answers.zodiac_sign) || profile.zodiac_sign || 'Not shared';
                
                return `
                    <div class="guest-card">
                        <div class="guest-name">${index + 1}. ${profile.display_name}</div>
                        <div class="guest-meta">
                            <span>üìç ${profile.birth_city || 'Birth city not shared'}</span>
                            <span>‚ôà ${zodiac}</span>
                            <span class="badge">${answerCount} responses</span>
                            ${isComplete ? '<span class="badge" style="background: #48bb7815; border-color: #48bb7830; color: #48bb78;">‚úì Complete</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('guest-list-view').style.display = 'block';
        }

        function showPhotos() {
            const container = document.getElementById('photos-content');
            
            if (globalPhotos.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #a0aec0;">No photos submitted yet.</p>';
            } else {
                // Sort alphabetically by display_name
                const sortedPhotos = [...globalPhotos].sort((a, b) => {
                    const profileA = globalProfiles.find(p => p.user_id === a.user_id);
                    const profileB = globalProfiles.find(p => p.user_id === b.user_id);
                    const nameA = profileA ? profileA.display_name : 'Unknown';
                    const nameB = profileB ? profileB.display_name : 'Unknown';
                    return nameA.localeCompare(nameB);
                });
                
                container.innerHTML = sortedPhotos.map(photo => {
                    const profile = globalProfiles.find(p => p.user_id === photo.user_id);
                    const photoUrl = photo.content && photo.content.photo_url;
                    
                    return `
                        <div class="photo-card">
                            ${photoUrl ? `<img src="${photoUrl}" class="photo-img" alt="Baby photo" />` : '<div style="width: 200px; height: 200px; background: #e2e8f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">No photo URL</div>'}
                            <div class="guest-name" style="font-size: 18px;">${profile ? profile.display_name : 'Unknown'}</div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('photos-view').style.display = 'block';
        }

        function showBirthCities() {
            const container = document.getElementById('birth-cities-content');
            
            // Count users per city and collect coordinates AND names
            const cityCounts = {};
            const cityCoords = {};
            const cityPeople = {}; // NEW: Store people's names per city
            
            globalProfiles.forEach(profile => {
                if (profile.birth_city) {
                    cityCounts[profile.birth_city] = (cityCounts[profile.birth_city] || 0) + 1;
                    
                    // Store coordinates if available
                    if (profile.birth_lat && profile.birth_lng && !cityCoords[profile.birth_city]) {
                        cityCoords[profile.birth_city] = {
                            lat: profile.birth_lat,
                            lng: profile.birth_lng
                        };
                    }
                    
                    // Store people's names for this city
                    if (!cityPeople[profile.birth_city]) {
                        cityPeople[profile.birth_city] = [];
                    }
                    cityPeople[profile.birth_city].push(profile.display_name);
                }
            });
            
            // Sort by count descending
            const sortedCities = Object.entries(cityCounts)
                .sort((a, b) => b[1] - a[1]);
            
            if (sortedCities.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #a0aec0;">No birth cities shared yet.</p>';
            } else {
                // Create map container and city list
                container.innerHTML = `
                    <div style="margin-bottom: 30px;">
                        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);">
                            <h3 style="color: #2d3748; margin-bottom: 15px; font-size: 18px; font-weight: 700;">üåç World Map</h3>
                            <div id="birthCitiesMap" style="height: 400px; border-radius: 8px; overflow: hidden;"></div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);">
                        <h3 style="color: #2d3748; margin-bottom: 15px; font-size: 18px; font-weight: 700;">üìç Cities List</h3>
                        ${sortedCities.map(([city, count]) => `
                            <div class="city-card">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div class="city-name">üìç ${city}</div>
                                        <div style="font-size: 13px; color: #718096; margin-top: 4px;">
                                            ${count} ${count === 1 ? 'guest' : 'guests'} born here
                                        </div>
                                    </div>
                                    <div class="city-count">${count}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // Initialize Leaflet map
                setTimeout(() => {
                    if (typeof L === 'undefined') {
                        console.error('Leaflet not loaded');
                        return;
                    }
                    
                    const map = L.map('birthCitiesMap').setView([20, 0], 2);
                    
                    // Add OpenStreetMap tiles
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors',
                        maxZoom: 18
                    }).addTo(map);
                    
                    // Add markers for cities with coordinates
                    const maxCount = Math.max(...Object.values(cityCounts));
                    
                    Object.entries(cityCoords).forEach(([city, coords]) => {
                        const count = cityCounts[city];
                        const radius = 8 + (count / maxCount) * 25;
                        
                        const circle = L.circleMarker([coords.lat, coords.lng], {
                            radius: radius,
                            fillColor: '#667eea',
                            color: '#fff',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.7
                        }).addTo(map);
                        
                        const plural = count === 1 ? 'guest' : 'guests';
                        const people = cityPeople[city] || [];
                        const namesList = people.join(', ');
                        
                        circle.bindPopup(`
                            <div style="text-align: center; padding: 8px;">
                                <strong style="color: #2d3748; font-size: 16px;">${city}</strong><br>
                                <span style="color: #718096; font-size: 14px;">${count} ${plural}</span><br>
                                <span style="color: #4a5568; font-size: 12px; margin-top: 4px; display: inline-block;">${namesList}</span>
                            </div>
                        `);
                    });
                    
                    // Fit bounds if we have markers
                    if (Object.keys(cityCoords).length > 0) {
                        const bounds = Object.values(cityCoords).map(c => [c.lat, c.lng]);
                        map.fitBounds(bounds, { padding: [50, 50] });
                    }
                }, 100);
            }
            
            document.getElementById('birth-cities-view').style.display = 'block';
        }

        // === SHOW ZODIAC SIGNS ===
        function showZodiacSigns() {
            const container = document.getElementById('zodiac-signs-content');
            
            // Zodiac sign emojis and order
            const zodiacInfo = {
                'Aries': { emoji: '‚ôà', order: 1 },
                'Taurus': { emoji: '‚ôâ', order: 2 },
                'Gemini': { emoji: '‚ôä', order: 3 },
                'Cancer': { emoji: '‚ôã', order: 4 },
                'Leo': { emoji: '‚ôå', order: 5 },
                'Virgo': { emoji: '‚ôç', order: 6 },
                'Libra': { emoji: '‚ôé', order: 7 },
                'Scorpio': { emoji: '‚ôè', order: 8 },
                'Sagittarius': { emoji: '‚ôê', order: 9 },
                'Capricorn': { emoji: '‚ôë', order: 10 },
                'Aquarius': { emoji: '‚ôí', order: 11 },
                'Pisces': { emoji: '‚ôì', order: 12 }
            };
            
            // Count users per zodiac and collect names
            const zodiacCounts = {};
            const zodiacPeople = {};
            
            globalProfiles.forEach(profile => {
                const zodiac = (profile.extended_answers && profile.extended_answers.zodiac_sign) || profile.zodiac_sign;
                if (zodiac && zodiac !== 'Not shared') {
                    zodiacCounts[zodiac] = (zodiacCounts[zodiac] || 0) + 1;
                    if (!zodiacPeople[zodiac]) {
                        zodiacPeople[zodiac] = [];
                    }
                    zodiacPeople[zodiac].push(profile.display_name);
                }
            });
            
            // Get all zodiac signs with counts (sorted by count descending)
            const sortedZodiacs = Object.entries(zodiacCounts)
                .sort((a, b) => b[1] - a[1]); // Sort by count, highest first
            
            const totalWithZodiac = Object.values(zodiacCounts).reduce((sum, count) => sum + count, 0);
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f7fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <div style="font-size: 14px; color: #718096;">
                        <strong>${totalWithZodiac}</strong> guests have shared their zodiac sign
                    </div>
                </div>
                <div style="display: grid; gap: 12px;">
            `;
            
            sortedZodiacs.forEach(([zodiac, count]) => {
                const info = zodiacInfo[zodiac];
                const emoji = info ? info.emoji : '‚≠ê';
                const people = zodiacPeople[zodiac] || [];
                const names = people.join(', ');
                const percentage = ((count / totalWithZodiac) * 100).toFixed(1);
                
                html += `
                    <div style="padding: 15px; background: white; border: 1px solid #e2e8f0; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="font-size: 18px; font-weight: 600; color: #2d3748;">
                                ${emoji} ${zodiac}
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span style="font-size: 16px; font-weight: 600; color: #667eea;">${count}</span>
                                <span style="font-size: 12px; color: #a0aec0;">(${percentage}%)</span>
                            </div>
                        </div>
                        <div style="height: 6px; background: #edf2f7; border-radius: 3px; overflow: hidden; margin-bottom: 8px;">
                            <div style="height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: ${percentage}%;"></div>
                        </div>
                        <div style="font-size: 12px; color: #718096;">
                            ${names}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            document.getElementById('zodiac-signs-view').style.display = 'block';
        }

        function showCompletedProfiles() {
            const completed = globalProfiles.filter(p => p.extended_answers && Object.keys(p.extended_answers).length > 15);
            const container = document.getElementById('completed-profiles-content');
            
            if (completed.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #a0aec0;">No completed profiles yet.</p>';
            } else {
                // Sort alphabetically by display_name
                const sortedCompleted = [...completed].sort((a, b) => 
                    a.display_name.localeCompare(b.display_name)
                );
                
                container.innerHTML = sortedCompleted.map((profile, index) => {
                    const answers = profile.extended_answers || {};
                    
                    return `
                        <div class="guest-card">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 24px; font-weight: 700; color: #a0aec0; min-width: 40px;">${index + 1}.</div>
                                <div style="flex: 1;">
                                    <div class="guest-name">${profile.display_name}</div>
                                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                                        ${Object.entries(answers).slice(0, 5).map(([q, a]) => `
                                            <div style="margin: 8px 0; font-size: 14px;">
                                                <span style="color: #718096;">${questionLabels[q] || q}:</span>
                                                <span style="color: #2d3748; font-weight: 600;"> ${a}</span>
                                            </div>
                                        `).join('')}
                                        ${Object.keys(answers).length > 5 ? `<div style="margin-top: 10px; font-size: 12px; color: #a0aec0;">+ ${Object.keys(answers).length - 5} more responses</div>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('completed-profiles-view').style.display = 'block';
        }

        function showAnswerInsights() {
            const container = document.getElementById('answer-insights-content');
            const answerCounts = {};

            // Count answers across all questions
            globalProfiles.forEach(profile => {
                if (profile.extended_answers) {
                    Object.entries(profile.extended_answers).forEach(([question, answer]) => {
                        if (!answerCounts[question]) {
                            answerCounts[question] = {};
                        }
                        if (!answerCounts[question][answer]) {
                            answerCounts[question][answer] = 0;
                        }
                        answerCounts[question][answer]++;
                    });
                }
            });

            // Show top questions with bar charts
            const html = Object.keys(answerCounts).slice(0, 10).map(question => {
                const answers = answerCounts[question];
                const sortedAnswers = Object.entries(answers)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                const maxCount = sortedAnswers[0][1];
                const totalResponses = Object.values(answers).reduce((sum, count) => sum + count, 0);

                return `
                    <div style="margin-bottom: 40px; padding: 25px; background: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);">
                        <h3 style="color: #2d3748; margin-bottom: 20px; font-size: 18px; font-weight: 700;">
                            ${questionLabels[question] || question}
                        </h3>
                        ${sortedAnswers.map(([answer, count]) => {
                            const percentage = (count / maxCount) * 100;
                            const responsePercentage = ((count / totalResponses) * 100).toFixed(1);
                            return `
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px;">
                                        <span style="color: #4a5568;">${answer.substring(0, 50)}${answer.length > 50 ? '...' : ''}</span>
                                        <span style="color: #2d3748; font-weight: 700;">${count} (${responsePercentage}%)</span>
                                    </div>
                                    <div style="width: 100%; height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden;">
                                        <div style="width: ${percentage}%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.5s ease; border-radius: 5px;"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
            document.getElementById('answer-insights-view').style.display = 'block';
        }

        function showIncompleteProfiles() {
            const container = document.getElementById('incomplete-profiles-content');
            
            // Find users who are fully complete (About You + Baby Photo)
            const usersWithPhotos = new Set(globalPhotos.map(p => p.user_id));
            const fullyCompleteUserIds = new Set(
                globalProfiles
                    .filter(p => p.extended_answers && Object.keys(p.extended_answers).length > 15)
                    .filter(p => usersWithPhotos.has(p.user_id))
                    .map(p => p.user_id)
            );
            
            // Incomplete users = all auth users minus fully complete
            const incompleteUsers = globalAllAuthUsers.filter(u => !fullyCompleteUserIds.has(u.id));
            
            if (incompleteUsers.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #a0aec0;">All users have completed their profiles and uploaded baby photos! üéâ</p>';
            } else {
                // Sort alphabetically by display_name, then by email for those without display_name
                const sortedIncomplete = [...incompleteUsers].sort((a, b) => {
                    const profileA = globalProfiles.find(p => p.user_id === a.id);
                    const profileB = globalProfiles.find(p => p.user_id === b.id);
                    const nameA = profileA?.display_name || a.email;
                    const nameB = profileB?.display_name || b.email;
                    return nameA.localeCompare(nameB);
                });
                
                container.innerHTML = sortedIncomplete.map((user, index) => {
                    // Try to find profile data to get display_name
                    const profile = globalProfiles.find(p => p.user_id === user.id);
                    const hasProfile = !!profile;
                    const hasPhoto = globalPhotos.some(p => p.user_id === user.id);
                    const answersCount = profile?.extended_answers ? Object.keys(profile.extended_answers).length : 0;
                    
                    // Determine what's missing
                    let missingItems = [];
                    if (!hasProfile || answersCount < 16) {
                        missingItems.push(`About You (${answersCount}/21 answers)`);
                    }
                    if (!hasPhoto) {
                        missingItems.push('Baby Photo');
                    }
                    
                    return `
                        <div class="guest-card">
                            <div style="display: flex; align-items: flex-start; gap: 15px;">
                                <div style="font-size: 24px; font-weight: 700; color: #a0aec0; min-width: 40px;">${index + 1}.</div>
                                <div style="flex: 1;">
                                    <div class="guest-name" style="color: ${hasProfile ? '#2d3748' : '#ed8936'};">
                                        ${profile ? profile.display_name : '‚è≥ Incomplete'}
                                    </div>
                                    <div class="guest-email">${user.email}</div>
                                    <div class="guest-meta" style="margin-top: 10px;">
                                        <span style="font-size: 12px; color: #a0aec0;">Joined: ${new Date(user.created_at).toLocaleDateString()}</span>
                                        <span class="badge" style="background: #fed7d715; border-color: #fed7d730; color: #f56565;">
                                            Missing: ${missingItems.join(', ')}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('incomplete-profiles-view').style.display = 'block';
        }

        function closeDetailView(viewId) {
            document.getElementById(viewId).style.display = 'none';
        }

    </script>
</body>
</html>
