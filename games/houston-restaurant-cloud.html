<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Houston Restaurant Cloud ‚Äî Party Game</title>
  <style>
    :root{
      --bg:#0c0c0f;
      --fg:#f4f4f7;
      --muted:#9aa0a6;
      --accent:#ffd166;
      --accent2:#06d6a0;
      --danger:#ef476f;
      --shadow: rgba(0,0,0,.35);
      /* Dilwale brand colors */
      --brand-red:#dc2626;
      --brand-gold:#fbbf24;
      --brand-orange:#f97316;
      /* Cuisine colors */
      --desi-color:#f472b6;
      --asian-color:#fbbf24;
      --american-color:#60a5fa;
      --mexican-color:#34d399;
      --mediterranean-color:#a78bfa;
      --other-color:#fb923c;
    }
    html,body{
      height:100%;
      margin:0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    .wrap{
      height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:20px;
      padding:20px;
    }
    .controls{
      width:100%; max-width:1200px;
      display:flex; align-items:center; justify-content:center;
      gap:12px; flex-wrap:wrap;
    }
    button{
      background:#17171c; color:var(--fg); border:1px solid #2a2a31;
      padding:12px 20px; border-radius:10px; cursor:pointer; font-weight:600;
      box-shadow: 0 6px 20px var(--shadow);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); border-color:#3a3a44; }
    button:active{ transform: translateY(0); }
    button.active{
      background: linear-gradient(135deg, var(--brand-red), var(--brand-orange));
      border-color: var(--brand-gold);
    }
    .stage{
      position:relative; width:100%; max-width:1200px; height:80vh;
      flex:1 1 auto; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 600px at 50% 30%, #16161b, #0e0e12 70%, #0b0b0e 90%);
      border:4px solid transparent;
      border-image: linear-gradient(135deg, var(--brand-red), var(--brand-orange), var(--brand-gold)) 1;
      border-radius:20px;
      overflow:hidden;
      box-shadow: 
        0 24px 60px var(--shadow),
        0 0 0 1px rgba(220, 38, 38, 0.3),
        inset 0 0 40px rgba(220, 38, 38, 0.05);
    }
    .logo-frame{
      position:absolute;
      bottom:12px;
      left:12px;
      z-index:10;
      opacity:0.4;
      transition: opacity 0.3s ease;
    }
    .logo-frame:hover{
      opacity:0.7;
    }
    .logo-frame img{
      height:32px;
      width:auto;
      display:block;
      filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.5));
    }
    .cloud-container{
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      padding:40px;
      position:relative;
    }
    .word-cloud{
      width:100%; height:100%;
      display:flex; flex-wrap:wrap; align-items:center; justify-content:center;
      gap:20px;
      position:relative;
    }
    .restaurant-word{
      display:inline-block;
      padding:8px 16px;
      margin:4px;
      cursor:pointer;
      transition: transform 0.3s ease, opacity 0.3s ease;
      font-weight:700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      border-radius:8px;
      background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      backdrop-filter: blur(4px);
    }
    .restaurant-word:hover{
      transform: scale(1.15);
      background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    .restaurant-word.hidden{
      opacity:0.2;
      transform: scale(0.9);
    }
    .stats-overlay{
      position:absolute;
      top:20px;
      right:20px;
      background: linear-gradient(135deg, rgba(0,0,0,.85), rgba(0,0,0,.7));
      backdrop-filter: blur(10px);
      padding:16px 24px;
      border-radius:12px;
      border:2px solid rgba(220, 38, 38, 0.4);
      box-shadow: 0 8px 24px rgba(0,0,0,.6);
      text-align:right;
    }
    .stats-overlay h3{
      margin:0 0 8px 0;
      font-size:1rem;
      color:var(--muted);
      font-weight:600;
    }
    .stats-overlay .big-number{
      font-size:2.5rem;
      font-weight:900;
      background: linear-gradient(135deg, var(--brand-red), var(--brand-orange), var(--brand-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin:0;
    }
    .loading-overlay{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(12,12,15,0.95); z-index:100; flex-direction:column; gap:16px;
    }
    .spinner{
      width:40px; height:40px; border:3px solid #2a2a31;
      border-top-color:var(--brand-red); border-radius:50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    .legend{
      display:flex; gap:20px; align-items:center; justify-content:center;
      font-size:0.9rem;
      flex-wrap:wrap;
    }
    .legend-item{
      display:flex; align-items:center; gap:8px;
    }
    .legend-dot{
      width:12px; height:12px; border-radius:50%;
    }
    .tooltip{
      position:fixed;
      background: rgba(0,0,0,0.9);
      color:var(--fg);
      padding:8px 12px;
      border-radius:6px;
      font-size:0.85rem;
      pointer-events:none;
      z-index:1000;
      opacity:0;
      transition:opacity 0.2s ease;
      border:1px solid rgba(255,255,255,0.2);
      max-width:300px;
    }
    .tooltip.show{ opacity:1; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="controls">
      <button id="allBtn" class="active">All Restaurants</button>
      <button id="desiBtn">Desi/Pakistani</button>
      <button id="asianBtn">Asian</button>
      <button id="mexicanBtn">Mexican</button>
      <button id="americanBtn">American</button>
      <button id="mediterraneanBtn">Mediterranean</button>
      <button id="otherBtn">Other</button>
      <button id="refreshBtn">üîÑ Refresh</button>
    </div>

    <div class="stage" id="stage">
      <div class="logo-frame">
        <img src="../assets/img/dilwale_logo.png" alt="Dilwale Logo" />
      </div>
      
      <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="color:var(--muted); font-weight:600;">Loading Houston restaurants...</div>
      </div>

      <div class="stats-overlay">
        <h3>Unique Restaurants</h3>
        <p class="big-number" id="restaurantCount">0</p>
      </div>

      <div class="cloud-container">
        <div class="word-cloud" id="wordCloud"></div>
      </div>
    </div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-dot" style="background:var(--desi-color);"></div>
        <span>Desi/Pakistani</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:var(--asian-color);"></div>
        <span>Asian</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:var(--mexican-color);"></div>
        <span>Mexican</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:var(--american-color);"></div>
        <span>American</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:var(--mediterranean-color);"></div>
        <span>Mediterranean</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:var(--other-color);"></div>
        <span>Other</span>
      </div>
    </div>
  </div>

  <div id="tooltip" class="tooltip"></div>

  <!-- Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../config/env.local.js"></script>

  <script>
    // ======== VERIFY CONFIG LOADED ========
    if (typeof CONFIG === 'undefined') {
      console.error('‚ùå CONFIG not loaded! Check if config/env.local.js exists');
      document.getElementById('loadingOverlay').innerHTML = `
        <div style="color:var(--danger); font-weight:600;">Configuration Error</div>
        <div style="color:var(--muted); font-size:0.9rem;">config/env.local.js not found</div>
      `;
      throw new Error('CONFIG is undefined');
    }
    
    console.log('‚úÖ Config loaded');
    
    // ======== SUPABASE SETUP ========
    const { createClient } = supabase;
    const supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
    console.log('‚úÖ Supabase client initialized');
    
    // ======== DATA STRUCTURES ========
    let restaurantData = [];
    let currentFilter = 'all';
    
    // Restaurant normalization map - handle common variations/typos
    const restaurantNormalization = {
      // Desi/Pakistani spots
      'agas': "Aga's",
      'aga': "Aga's",
      "aga's": "Aga's",
      'agaas': "Aga's",
      'bismillah': 'Bismillah',
      'lasbela': 'Lasbela',
      'las bela': 'Lasbela',
      'tempura': 'Tempura',
      'himalaya': 'Himalaya',
      'the himalaya': 'Himalaya',
      'bundoo khan': 'Bundoo Khan',
      'bundu khan': 'Bundoo Khan',
      'khan': 'Bundoo Khan',
      'biryani pot': 'Biryani Pot',
      'karachi': 'Karachi Kitchen',
      'karachi kitchen': 'Karachi Kitchen',
      'tarka': 'Tarka',
      'tarka indian kitchen': 'Tarka',
      'currys': "Curry's Indian Cuisine",
      'currys indian cuisine': "Curry's Indian Cuisine",
      
      // Asian restaurants
      'mala sichuan': 'Mala Sichuan',
      'pepper twins': 'Pepper Twins',
      'the pit room': 'The Pit Room',
      'uchi': 'Uchi',
      'uchiko': 'Uchiko',
      'kata robata': 'Kata Robata',
      'roka akor': 'Roka Akor',
      'mf sushi': 'MF Sushi',
      'state of grace': 'State of Grace',
      
      // Mexican
      'ninfa': "Ninfa's",
      "ninfa's": "Ninfa's",
      'ninfas': "Ninfa's",
      'hugos': "Hugo's",
      "hugo's": "Hugo's",
      'hugo': "Hugo's",
      'el tiempo': 'El Tiempo',
      'velvet taco': 'Velvet Taco',
      'torchys': "Torchy's",
      "torchy's": "Torchy's",
      'torchys tacos': "Torchy's",
      
      // American/BBQ
      'killen': "Killen's",
      "killen's": "Killen's",
      'killens': "Killen's",
      "killen's bbq": "Killen's BBQ",
      'the pit room': 'The Pit Room',
      'corkscrew': 'Corkscrew BBQ',
      'corkscrew bbq': 'Corkscrew BBQ',
      'truth bbq': 'Truth BBQ',
      'truth': 'Truth BBQ',
      'feges': 'Feges BBQ',
      'feges bbq': 'Feges BBQ',
      'pappas': "Pappas",
      "pappas bbq": "Pappas BBQ",
      'pappadeaux': 'Pappadeaux',
      'pappas seafood': 'Pappas Seafood',
      'the breakfast klub': 'The Breakfast Klub',
      'breakfast klub': 'The Breakfast Klub',
      
      // Mediterranean/Middle Eastern
      'aladdin': 'Aladdin',
      'aladdins': 'Aladdin',
      "aladdin's": 'Aladdin',
      'fadi': "Fadi's",
      "fadi's": "Fadi's",
      'fadis': "Fadi's",
      'garson': 'Garson',
      'garson turkish': 'Garson',
      
      // Chain/Fast food
      'chick fil a': 'Chick-fil-A',
      'chick-fil-a': 'Chick-fil-A',
      'chickfila': 'Chick-fil-A',
      'whataburger': 'Whataburger',
      'in n out': 'In-N-Out',
      'in-n-out': 'In-N-Out',
      'shake shack': 'Shake Shack',
      'chipotle': 'Chipotle',
    };
    
    // Restaurant cuisine/category mapping
    const restaurantCuisine = {
      // Desi/Pakistani
      "aga's": 'desi',
      'bismillah': 'desi',
      'lasbela': 'desi',
      'tempura': 'desi',
      'himalaya': 'desi',
      'bundoo khan': 'desi',
      'biryani pot': 'desi',
      'karachi kitchen': 'desi',
      'tarka': 'desi',
      "curry's indian cuisine": 'desi',
      'london sizzler': 'desi',
      'khyber': 'desi',
      'maharaja bhog': 'desi',
      'bombay pizza': 'desi',
      
      // Asian
      'mala sichuan': 'asian',
      'pepper twins': 'asian',
      'uchi': 'asian',
      'uchiko': 'asian',
      'kata robata': 'asian',
      'roka akor': 'asian',
      'mf sushi': 'asian',
      'uchi houston': 'asian',
      'tiger den': 'asian',
      'nanking': 'asian',
      'ocean palace': 'asian',
      'pho binh': 'asian',
      'simply pho': 'asian',
      'crawfish & noodles': 'asian',
      
      // Mexican
      "ninfa's": 'mexican',
      "hugo's": 'mexican',
      'el tiempo': 'mexican',
      'velvet taco': 'mexican',
      "torchy's": 'mexican',
      'tacos a go go': 'mexican',
      'the original ninfa': 'mexican',
      'el real': 'mexican',
      'xochi': 'mexican',
      
      // American/BBQ
      "killen's": 'american',
      "killen's bbq": 'american',
      'the pit room': 'american',
      'corkscrew bbq': 'american',
      'truth bbq': 'american',
      'feges bbq': 'american',
      'pappas': 'american',
      'pappas bbq': 'american',
      'pappadeaux': 'american',
      'pappas seafood': 'american',
      'the breakfast klub': 'american',
      'state of grace': 'american',
      'underbelly': 'american',
      'oxheart': 'american',
      'the pass & provisions': 'american',
      'georgia james': 'american',
      'chick-fil-a': 'american',
      'whataburger': 'american',
      'in-n-out': 'american',
      'shake shack': 'american',
      
      // Mediterranean/Middle Eastern
      'aladdin': 'mediterranean',
      "fadi's": 'mediterranean',
      'garson': 'mediterranean',
      'istanbul grill': 'mediterranean',
      'phoenicia': 'mediterranean',
      
      // Other/Mixed
      'chipotle': 'other',
      'cava': 'other',
    };
    
    // ======== LOAD DATA FROM SUPABASE ========
    async function loadRestaurantData() {
      try {
        const PARTY_SLUG = 'friendsgiving2025-1ty7';
        
        console.log('üîç Loading Houston restaurant data...');
        
        // Get party ID
        const { data: party, error: partyError } = await supabaseClient
          .from('parties')
          .select('id')
          .eq('slug', PARTY_SLUG)
          .single();
        
        if (partyError) throw partyError;
        console.log('‚úÖ Party found:', party.id);
        
        // Get all profiles with extended_answers
        const { data: profiles, error: profileError } = await supabaseClient
          .from('party_profiles')
          .select('user_id, display_name, extended_answers')
          .eq('party_id', party.id);
        
        if (profileError) throw profileError;
        console.log(`‚úÖ Found ${profiles.length} profiles`);
        
        // Extract and count restaurants with normalization
        const restaurantCount = {};
        
        profiles.forEach(profile => {
          let restaurant = profile.extended_answers?.food_desi_restaurant;
          
          // Check if this is a write-in custom restaurant (format: X:other:Custom Name)
          if (restaurant && restaurant.startsWith('X:')) {
            const parts = restaurant.split(':');
            if (parts.length >= 3) {
              // Extract the custom restaurant name after "X:other:"
              restaurant = parts.slice(2).join(':').trim();
              console.log(`üìù Found custom restaurant: "${restaurant}"`);
            }
          }
          
          if (restaurant && restaurant.trim() && restaurant.toLowerCase() !== 'not shared' && restaurant.toLowerCase() !== 'other') {
            // Apply smart normalization
            const normalizedRestaurant = normalizeRestaurantName(restaurant);
            
            if (!restaurantCount[normalizedRestaurant]) {
              restaurantCount[normalizedRestaurant] = {
                name: normalizedRestaurant,
                count: 0,
                cuisine: detectCuisine(normalizedRestaurant),
                guests: [],
                originalInputs: [] // Track what people actually typed
              };
            }
            restaurantCount[normalizedRestaurant].count++;
            restaurantCount[normalizedRestaurant].guests.push(profile.display_name);
            restaurantCount[normalizedRestaurant].originalInputs.push(restaurant.trim());
          }
        });
        
        // Convert to array and sort by count
        restaurantData = Object.values(restaurantCount).sort((a, b) => b.count - a.count);
        
        console.log(`‚úÖ Found ${restaurantData.length} unique restaurants`);
        console.log('Top restaurants:', restaurantData.slice(0, 5));
        
        document.getElementById('loadingOverlay').style.display = 'none';
        document.getElementById('restaurantCount').textContent = restaurantData.length;
        
        renderWordCloud();
        
      } catch (error) {
        console.error('Error loading restaurant data:', error);
        document.getElementById('loadingOverlay').innerHTML = `
          <div style="color:var(--danger); font-weight:600;">Failed to load data</div>
          <div style="color:var(--muted); font-size:0.9rem;">Check console for details</div>
        `;
      }
    }
    
    // ======== NORMALIZE RESTAURANT NAME ========
    function normalizeRestaurantName(rawName) {
      if (!rawName) return '';
      
      // Step 1: Basic cleanup
      let cleaned = rawName.trim();
      
      // Step 2: Remove common filler words and punctuation cleanup
      cleaned = cleaned
        .replace(/[!?.,;:]/g, '') // Remove punctuation
        .replace(/\s+/g, ' ') // Normalize whitespace
        .replace(/restaurant$/i, '') // Remove trailing "Restaurant"
        .replace(/grill$/i, '') // Remove trailing "Grill"
        .trim();
      
      // Step 3: Check against normalization map (case-insensitive)
      const lowerCleaned = cleaned.toLowerCase();
      if (restaurantNormalization[lowerCleaned]) {
        console.log(`üîÑ Normalized "${rawName}" ‚Üí "${restaurantNormalization[lowerCleaned]}"`);
        return restaurantNormalization[lowerCleaned];
      }
      
      // Step 4: Title case for consistent formatting
      const titleCased = cleaned
        .split(' ')
        .map(word => {
          // Keep possessives and short words
          if (word.includes("'")) return word;
          if (['and', 'the', 'at', 'of', 'bbq'].includes(word.toLowerCase())) {
            return word.toUpperCase() === 'BBQ' ? 'BBQ' : word.toLowerCase();
          }
          // Title case regular words
          return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
        })
        .join(' ');
      
      // Step 5: Check if title-cased version matches normalization map
      const lowerTitled = titleCased.toLowerCase();
      if (restaurantNormalization[lowerTitled]) {
        console.log(`üîÑ Normalized "${rawName}" ‚Üí "${restaurantNormalization[lowerTitled]}"`);
        return restaurantNormalization[lowerTitled];
      }
      
      console.log(`‚ú® Using cleaned name: "${rawName}" ‚Üí "${titleCased}"`);
      return titleCased;
    }
    
    // ======== DETECT CUISINE FROM RESTAURANT ========
    function detectCuisine(restaurantName) {
      const normalized = restaurantName.toLowerCase().trim();
      
      // Check exact matches first
      if (restaurantCuisine[normalized]) {
        return restaurantCuisine[normalized];
      }
      
      // Check partial matches
      for (const [restaurant, cuisine] of Object.entries(restaurantCuisine)) {
        if (normalized.includes(restaurant) || restaurant.includes(normalized)) {
          return cuisine;
        }
      }
      
      // Keyword-based detection
      if (normalized.includes('biryani') || normalized.includes('curry') || normalized.includes('desi') || 
          normalized.includes('indian') || normalized.includes('pakistani') || normalized.includes('kabab')) {
        return 'desi';
      }
      if (normalized.includes('sushi') || normalized.includes('ramen') || normalized.includes('pho') ||
          normalized.includes('chinese') || normalized.includes('thai') || normalized.includes('vietnamese')) {
        return 'asian';
      }
      if (normalized.includes('taco') || normalized.includes('mexican') || normalized.includes('tex-mex')) {
        return 'mexican';
      }
      if (normalized.includes('bbq') || normalized.includes('steakhouse') || normalized.includes('burger')) {
        return 'american';
      }
      if (normalized.includes('mediterranean') || normalized.includes('greek') || normalized.includes('turkish') ||
          normalized.includes('shawarma') || normalized.includes('kebab') || normalized.includes('falafel')) {
        return 'mediterranean';
      }
      
      return 'other';
    }
    
    // ======== GET COLOR BY CUISINE ========
    function getCuisineColor(cuisine) {
      const colorMap = {
        'desi': 'var(--desi-color)',
        'asian': 'var(--asian-color)',
        'mexican': 'var(--mexican-color)',
        'american': 'var(--american-color)',
        'mediterranean': 'var(--mediterranean-color)',
        'other': 'var(--other-color)'
      };
      return colorMap[cuisine] || colorMap['other'];
    }
    
    // ======== RENDER WORD CLOUD ========
    function renderWordCloud() {
      const container = document.getElementById('wordCloud');
      container.innerHTML = '';
      
      // Filter data based on current filter
      const filteredData = restaurantData.filter(restaurant => {
        if (currentFilter === 'all') return true;
        return restaurant.cuisine === currentFilter;
      });
      
      if (filteredData.length === 0) {
        container.innerHTML = '<div style="color:var(--muted); font-size:1.5rem;">No restaurants found for this filter</div>';
        return;
      }
      
      // Calculate font sizes (min 1rem, max 5rem based on count)
      const maxCount = Math.max(...filteredData.map(r => r.count));
      const minCount = Math.min(...filteredData.map(r => r.count));
      
      filteredData.forEach(restaurant => {
        const word = document.createElement('div');
        word.className = 'restaurant-word';
        word.textContent = restaurant.name;
        
        // Calculate font size (logarithmic scale for better distribution)
        const ratio = maxCount === minCount ? 1 : (Math.log(restaurant.count) - Math.log(minCount)) / (Math.log(maxCount) - Math.log(minCount));
        const fontSize = 1 + (ratio * 4); // 1rem to 5rem
        word.style.fontSize = `${fontSize}rem`;
        
        // Apply color based on cuisine
        word.style.color = getCuisineColor(restaurant.cuisine);
        
        // Add hover tooltip
        word.addEventListener('mouseenter', (e) => showTooltip(e, restaurant));
        word.addEventListener('mouseleave', hideTooltip);
        word.addEventListener('mousemove', moveTooltip);
        
        container.appendChild(word);
      });
      
      // Shuffle positions for more organic look
      const words = Array.from(container.children);
      words.sort(() => Math.random() - 0.5);
      words.forEach(word => container.appendChild(word));
    }
    
    // ======== TOOLTIP FUNCTIONS ========
    const tooltip = document.getElementById('tooltip');
    
    function showTooltip(e, restaurant) {
      const guestList = restaurant.guests.join(', ');
      
      // Show original inputs if there were variations normalized
      const uniqueInputs = [...new Set(restaurant.originalInputs)];
      const variationsText = uniqueInputs.length > 1 
        ? `<br><small style="color:var(--muted); font-style:italic;">Variations: ${uniqueInputs.join(', ')}</small>`
        : '';
      
      const cuisineName = {
        'desi': 'Desi/Pakistani',
        'asian': 'Asian',
        'mexican': 'Mexican',
        'american': 'American',
        'mediterranean': 'Mediterranean',
        'other': 'Other'
      }[restaurant.cuisine] || 'Other';
      
      tooltip.innerHTML = `
        <strong>${restaurant.name}</strong> <span style="color:${getCuisineColor(restaurant.cuisine)};">‚óè ${cuisineName}</span><br>
        ${restaurant.count} ${restaurant.count === 1 ? 'person' : 'people'}<br>
        <small style="color:var(--muted);">${guestList}</small>
        ${variationsText}
      `;
      tooltip.classList.add('show');
      moveTooltip(e);
    }
    
    function hideTooltip() {
      tooltip.classList.remove('show');
    }
    
    function moveTooltip(e) {
      tooltip.style.left = (e.clientX + 15) + 'px';
      tooltip.style.top = (e.clientY + 15) + 'px';
    }
    
    // ======== FILTER CONTROLS ========
    document.getElementById('allBtn').addEventListener('click', () => {
      currentFilter = 'all';
      updateActiveButton('allBtn');
      renderWordCloud();
    });
    
    document.getElementById('desiBtn').addEventListener('click', () => {
      currentFilter = 'desi';
      updateActiveButton('desiBtn');
      renderWordCloud();
    });
    
    document.getElementById('asianBtn').addEventListener('click', () => {
      currentFilter = 'asian';
      updateActiveButton('asianBtn');
      renderWordCloud();
    });
    
    document.getElementById('mexicanBtn').addEventListener('click', () => {
      currentFilter = 'mexican';
      updateActiveButton('mexicanBtn');
      renderWordCloud();
    });
    
    document.getElementById('americanBtn').addEventListener('click', () => {
      currentFilter = 'american';
      updateActiveButton('americanBtn');
      renderWordCloud();
    });
    
    document.getElementById('mediterraneanBtn').addEventListener('click', () => {
      currentFilter = 'mediterranean';
      updateActiveButton('mediterraneanBtn');
      renderWordCloud();
    });
    
    document.getElementById('otherBtn').addEventListener('click', () => {
      currentFilter = 'other';
      updateActiveButton('otherBtn');
      renderWordCloud();
    });
    
    document.getElementById('refreshBtn').addEventListener('click', () => {
      document.getElementById('loadingOverlay').style.display = 'flex';
      loadRestaurantData();
    });
    
    function updateActiveButton(activeId) {
      ['allBtn', 'desiBtn', 'asianBtn', 'mexicanBtn', 'americanBtn', 'mediterraneanBtn', 'otherBtn'].forEach(id => {
        document.getElementById(id).classList.toggle('active', id === activeId);
      });
    }
    
    // ======== INITIALIZE ========
    loadRestaurantData();
  </script>
</body>
</html>
